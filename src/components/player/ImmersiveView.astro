---
---
<!-- Immersive Overlay (Cinema Mode / TV Style) -->
<div id="immersive-player" class="immersive-overlay hidden">
    <!-- Dynamic Background Layer -->
    <div class="immersive-bg"></div>
    <div class="immersive-noise"></div>
    
    <!-- Top Bar -->
    <div class="immersive-header">
        <button id="collapse-player" class="icon-btn-ghost" aria-label="Minimizar">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>
        </button>
    </div>

    <!-- Main Content Grid -->
    <div class="immersive-layout">
        
        <!-- Center Stage: Cover Art -->
        <div class="stage-area">
            <div class="immersive-cover-wrapper">
                <img id="immersive-cover" src="/logo.png" alt="Cover" />
            </div>
        </div>

        <!-- Bottom Bar: Meta & Controls -->
        <div class="dock-area">
            
            <!-- Progress Line (floating above dock) -->
            <div class="progress-floating">
                 <span id="imm-current-time" class="time-label">00:00</span>
                 <div class="range-wrapper">
                    <input type="range" id="imm-seek-bar" value="0" step="0.1">
                 </div>
                 <span id="imm-duration" class="time-label">00:00</span>
            </div>

            <div class="dock-content">
                <!-- Left: Title & Info -->
                <div class="meta-block">
                    <h2 id="immersive-title">TÃ­tulo del Episodio</h2>
                    <p id="immersive-author">Veredillas FM</p>
                </div>

                <!-- Center/Right: Controls -->
                <div class="controls-block">
                     <!-- Visualizer (Subtle, background of controls) -->
                     <canvas id="audio-visualizer" width="300" height="60"></canvas>
                     
                     <div class="btn-row">
                         <button id="imm-back-btn" class="ctrl-btn-clean" aria-label="Retroceder 15s">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"></path></svg>
                         </button>
                         
                         <button id="imm-play-btn" class="play-btn-main" aria-label="Reproducir/Pausar">
                            <svg id="imm-icon-play" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                            <svg id="imm-icon-pause" class="hidden" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                         </button>
                         
                         <button id="imm-fwd-btn" class="ctrl-btn-clean" aria-label="Avanzar 15s">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"></path></svg>
                         </button>
                     </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
  /* -------------------------------
     IMMERSIVE MODE (VIBRANT TV STYLE) 
     ------------------------------- */
  .immersive-overlay {
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: #111; /* Fallback */
      display: flex;
      flex-direction: column;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
      overflow: hidden;
      touch-action: none;
  }

  .immersive-overlay:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
  }
  
  .hidden { display: none !important; }

  /* Dynamic Backgrounds */
  .immersive-bg {
      position: absolute;
      inset: -10%; /* Bleed for blur edges */
      width: 120%;
      height: 120%;
      background: var(--color-primary-glow, #444);
      /* Create a gradient overlay to emulate the reference style */
      background-image: 
        radial-gradient(circle at 20% 40%, rgba(255,255,255,0.1) 0%, transparent 50%),
        linear-gradient(to bottom right, transparent 0%, rgba(0,0,0,0.8) 100%);
      filter: blur(60px) contrast(1.2) brightness(0.8);
      z-index: 0;
      transition: background 1s ease;
  }
  
  .immersive-noise {
      position: absolute;
      inset: 0;
      opacity: 0.04;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      z-index: 1;
      pointer-events: none;
  }

  /* Header */
  .immersive-header {
      position: relative;
      z-index: 20;
      padding: max(20px, env(safe-area-inset-top)) 30px;
      display: flex;
      justify-content: flex-end;
  }

  .icon-btn-ghost {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.8);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(10px);
      transition: all 0.2s;
  }
  .icon-btn-ghost:hover {
      background: rgba(255,255,255,0.25);
      transform: scale(1.05);
      color: white;
  }

  /* Layout Body */
  .immersive-layout {
      position: relative;
      z-index: 10;
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 max(20px, env(safe-area-inset-right)) max(30px, env(safe-area-inset-bottom)) max(20px, env(safe-area-inset-left));
  }

  /* STAGE (Cover) */
  .stage-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding-bottom: 40px; /* Space for dock */
  }

  .immersive-cover-wrapper {
      width: clamp(250px, 80vw, 420px);
      aspect-ratio: 1/1;
      position: relative;
      /* Elegant shadow */
      box-shadow: 0 40px 80px -20px rgba(0,0,0,0.6); 
      border-radius: 12px;
      transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
  }
  
  /* Mobile Landscape Fix: Smaller cover */
  @media (max-height: 600px) and (orientation: landscape) {
       .stage-area { align-items: flex-end; padding-bottom: 20px; justify-content: flex-start; padding-left: 40px; }
       .immersive-cover-wrapper { width: 180px; margin: 0; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
  }

  .immersive-cover-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
  }

  /* DOCK Area */
  .dock-area {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
  }

  /* 1. Progress */
  .progress-floating {
      display: flex;
      align-items: center;
      gap: 16px;
  }

  .time-label {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      font-weight: 500;
      font-variant-numeric: tabular-nums;
      width: 45px;
      text-align: center;
  }

  .range-wrapper {
      flex: 1;
      height: 4px; /* Hit area */
      display: flex;
      align-items: center;
      position: relative;
      background: rgba(255,255,255,0.15);
      border-radius: 4px;
  }

  .range-wrapper input {
      width: 100%;
      height: 100%;
      opacity: 0; /* Purely touch target */
      cursor: pointer;
      position: absolute;
      z-index: 2;
      margin: 0;
  }
  /* Custom styled track manually due to input range limitation */
  /* Reverting to standard clear input styling for simplicity/reliability across browsers */
  .range-wrapper input {
      opacity: 1;
      -webkit-appearance: none;
      background: transparent;
      height: 20px; /* touch height */
      top: -8px;
  }
   .range-wrapper input::-webkit-slider-runnable-track {
       height: 4px;
       border-radius: 4px;
       background: rgba(255,255,255,0.2);
   }
   .range-wrapper input::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 14px;
        width: 14px;
        border-radius: 50%;
        background: white;
        margin-top: -5px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        transition: transform 0.1s;
   }
   .range-wrapper input:hover::-webkit-slider-thumb { transform: scale(1.3); }


  /* 2. Dock Content (Meta + Controls) */
  .dock-content {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: flex-end;
      gap: 20px;
  }
  
  .meta-block {
      text-align: left;
  }

  #immersive-title {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 800;
      line-height: 1.05;
      color: #fff;
      margin: 0 0 8px 0;
      text-shadow: 0 4px 12px rgba(0,0,0,0.2);
      
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
  }

  #immersive-author {
      font-size: clamp(1rem, 2vw, 1.25rem);
      color: rgba(255,255,255,0.7);
      margin: 0;
      font-weight: 500;
  }

  /* Controls Block */
  .controls-block {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
  }
  
  #audio-visualizer {
      width: 250px;
      height: 40px;
      opacity: 0.5;
  }

  .btn-row {
      display: flex;
      align-items: center;
      gap: 24px;
      padding-bottom: 5px;
  }

  .ctrl-btn-clean {
      background: none;
      border: none;
      color: rgba(255,255,255,0.6);
      cursor: pointer;
      transition: all 0.2s;
      padding: 8px;
  }
  .ctrl-btn-clean:hover { color: white; transform: scale(1.1); }

  .play-btn-main {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: white;
      color: black;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  }
  .play-btn-main:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  }

  /* RESPONSIVE: Mobile Portrait */
  @media (max-width: 768px) {
      .dock-content {
          grid-template-columns: 1fr; /* Stack */
          grid-template-rows: auto auto;
          text-align: left;
          gap: 30px;
      }
      
      .controls-block {
          align-items: flex-start; /* Left align controls on mobile too? Or center. */
          flex-direction: row-reverse; /* Put play button on right */
          justify-content: space-between;
          width: 100%;
      }
      
      .btn-row { flex: 1; justify-content: flex-end; }
      
      #audio-visualizer {
           display: none; /* Too cramped */
      }
      
      /* Make title smaller to fit */
      #immersive-title { font-size: 2rem; }
  }

  /* RESPONSIVE: Landscape Mobile */
  @media (max-height: 600px) and (orientation: landscape) {
      .immersive-layout {
          flex-direction: row;
          align-items: center;
          gap: 40px;
          padding: 20px 60px;
      }
      
      .stage-area {
          flex: 0;
          padding: 0;
      }

      .dock-area {
          flex: 1;
          display: flex;
          flex-direction: column;
          justify-content: center;
          height: 100%;
      }
      
      .dock-content {
           display: flex;
           flex-direction: column;
           align-items: flex-start;
           gap: 10px;
      }
      
      .controls-block {
          align-items: flex-start;
          width: 100%;
      }
      
      .btn-row { justify-content: flex-start; }
      
      #immersive-title { font-size: 2.2rem; }
      #audio-visualizer { display: none; }
  }
</style>
