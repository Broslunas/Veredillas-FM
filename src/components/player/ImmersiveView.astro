---
---
<!-- Immersive Overlay (Cinema Mode) -->
<div id="immersive-player" class="immersive-overlay hidden">
    <div class="background-glow"></div>
    
    <!-- Controls Top (Absolute) -->
    <div class="immersive-controls-top">
        <button id="toggle-lyrics" class="icon-btn" aria-label="Ver Transcripción">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
        </button>
        <button id="collapse-player" class="icon-btn" aria-label="Minimizar">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>
        </button>
    </div>

    <div class="immersive-container">
        
        <!-- Player Content (Left/Center) -->
        <div class="immersive-content">
            <div class="immersive-cover-wrapper">
                <img id="immersive-cover" src="/logo.png" alt="Cover" />
                <div class="vinyl-grooves"></div>
                <div class="center-label"></div>
            </div>
            
            <div class="immersive-meta">
                <h2 id="immersive-title">Título del Episodio</h2>
                <p id="immersive-author">Veredillas FM</p>
            </div>

            <canvas id="audio-visualizer"></canvas>

            <!-- Immersive Controls -->
            <div class="immersive-controls-bottom">
                 <div class="progress-container">
                    <span id="imm-current-time">00:00</span>
                    <input type="range" id="imm-seek-bar" value="0" step="0.1">
                    <span id="imm-duration">00:00</span>
                 </div>
                 
                 <div class="main-buttons">
                     <button id="imm-back-btn" class="ctrl-btn-lg" aria-label="Retroceder 15s">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 17l-5-5 5-5M18 17l-5-5 5-5"/></svg>
                     </button>
                     <button id="imm-play-btn" class="play-btn-xl" aria-label="Reproducir/Pausar">
                        <svg id="imm-icon-play" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M5 3l14 9-14 9V3z"/></svg>
                        <svg id="imm-icon-pause" class="hidden" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>
                     </button>
                     <button id="imm-fwd-btn" class="ctrl-btn-lg" aria-label="Avanzar 15s">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 17l5-5-5-5M6 17l5-5-5-5"/></svg>
                     </button>
                 </div>
            </div>
        </div>
        
        <!-- Lyrics Content (Right/Bottom) -->
        <div id="immersive-lyrics" class="immersive-lyrics hidden">
            <div class="lyrics-header">
                <h3>Letra</h3>
            </div>
            <div class="lyrics-trackable">
                <p class="lyrics-placeholder">No hay transcripción disponible para este episodio.</p>
            </div>
        </div>
    </div>
</div>

<style>
  /* IMMERSIVE MODE */
  .immersive-overlay {
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: #050505;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
  }

  .immersive-overlay:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
  }
  
  .hidden {
    display: none !important;
  }

  .immersive-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2;
      padding: 80px 20px 40px;
      gap: 30px;
      transition: all 0.5s ease;
  }
  
  @media (min-width: 1024px) {
      .immersive-container {
          flex-direction: row; /* Split view */
          padding: 60px 80px;
          gap: 60px;
          justify-content: center;
      }
      
      .immersive-container:has(.immersive-lyrics.hidden) {
          /* When lyrics hidden, center the player */
          justify-content: center;
      }
  }

  .background-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120vw;
      height: 120vw;
      border-radius: 50%;
      background: radial-gradient(circle at center, var(--color-primary-glow), rgba(0,0,0,0) 70%);
      opacity: 0.25;
      z-index: 1;
      pointer-events: none;
      filter: blur(80px); /* Enhance blur */
  }

  .immersive-content {
      text-align: center;
      width: 100%;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 auto;
      transition: all 0.5s ease;
  }
  
  /* Split View Logic */
  @media (min-width: 1024px) {
      .immersive-content {
          margin: 0; 
          /* If lyrics are visible, this takes half width */
          flex: 0 0 450px;
      }
      
      /* If using CSS has selector or conditional class on container */
      .immersive-container:has(.immersive-lyrics:not(.hidden)) .immersive-content {
          margin-right: auto;
      }
  }

  .immersive-cover-wrapper {
      width: clamp(250px, 40vh, 400px);
      height: clamp(250px, 40vh, 400px);
      margin: 0 auto 40px;
      border-radius: 12px;
      position: relative;
      box-shadow: 0 25px 60px -15px rgba(0,0,0,0.7);
      transition: transform 0.5s ease;
  }

  .immersive-cover-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
  }

  .immersive-meta h2 {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      background: linear-gradient(to bottom, #fff, #aaa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
  }
  
  .immersive-meta p {
      font-size: 1.2rem;
      color: var(--color-text-muted);
      margin-bottom: 2rem;
  }

  #audio-visualizer {
      width: 100%;
      height: 100px;
      margin-top: 20px;
      opacity: 0.8;
  }

  /* Immersive Top Controls */
  .immersive-controls-top {
      position: absolute;
      top: 40px;
      right: 40px;
      display: flex;
      gap: 15px;
      z-index: 10;
  }

  .icon-btn {
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      backdrop-filter: blur(10px);
  }
  
  .icon-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.05);
  }

  /* Immersive Controls Bottom */
  .immersive-controls-bottom {
      width: 100%;
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      gap: 20px;
  }

  .progress-container {
      display: flex;
      align-items: center;
      gap: 15px;
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      font-weight: 500;
      font-variant-numeric: tabular-nums;
  }
  
  .progress-container input[type="range"] {
      flex-grow: 1;
      height: 4px;
      border-radius: 2px;
      background: rgba(255,255,255,0.1); 
      cursor: pointer;
       -webkit-appearance: none;
       appearance: none;
  }
  
  .progress-container input[type="range"]::-webkit-slider-thumb {
       -webkit-appearance: none;
       width: 12px;
       height: 12px;
       background: white;
       border-radius: 50%;
       /* margin-top: -4px; Not needed if height is same as track, but here track is 4px. Browser default check. */
       box-shadow: 0 0 10px rgba(255,255,255,0.4);
       transition: transform 0.1s;
  }
  
  .progress-container input[type="range"]:hover::-webkit-slider-thumb {
       transform: scale(1.3);
  }

  .main-buttons {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
  }

  .ctrl-btn-lg {
      background: transparent;
      border: none;
      color: white;
      opacity: 0.8;
      cursor: pointer;
      transition: all 0.2s;
  }
  
  .ctrl-btn-lg:hover {
      opacity: 1;
      transform: scale(1.1);
  }
  
  .play-btn-xl {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: white;
      color: black;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  
  .play-btn-xl:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 40px rgba(255,255,255,0.2);
  }

  /* Immersive Lyrics Panel */
  .immersive-lyrics {
      width: 100%;
      display: flex;
      flex-direction: column;
      max-width: 600px;
      height: 100%;
      max-height: 40vh; /* Mobile height */
      background: rgba(255,255,255,0.02);
      border-radius: 24px;
      padding: 24px;
      border: 1px solid rgba(255,255,255,0.05);
      backdrop-filter: blur(20px);
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      margin-top: 20px;
  }
  
  @media (min-width: 1024px) {
      .immersive-lyrics {
          margin-top: 0;
          max-height: 100%;
          height: 100%;
          overflow: hidden;
          flex: 1; /* Take remaining space */
          max-width: 600px;
          background: transparent;
          border: none;
          backdrop-filter: none;
          padding: 0;
          padding-left: 40px;
          border-left: 1px solid rgba(255,255,255,0.1);
          border-radius: 0;
          
          /* Fade-ins */
          animation: slideInRight 0.5s ease-out;
      }
      
      .immersive-lyrics.hidden {
          display: none;
      }
      
      @keyframes slideInRight {
          from { opacity: 0; transform: translateX(20px); }
          to { opacity: 1; transform: translateX(0); }
      }
  }

  .lyrics-header h3 {
      margin: 0 0 20px 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
  }

  .lyrics-trackable {
      flex: 1;
      overflow-y: auto;
      padding-right: 10px;
      mask-image: linear-gradient(to bottom, transparent, black 5%, black 90%, transparent);
      -webkit-mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
  }
  
  /* Scrollbar override */
  .lyrics-trackable::-webkit-scrollbar {
      width: 4px;
  }
  .lyrics-trackable::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
  }

  :global(.lyric-line) {
      font-size: 1.5rem; /* Bigger text */
      font-weight: 500;
      color: rgba(255,255,255,0.4);
      margin-bottom: 24px;
      transition: all 0.3s ease;
      cursor: pointer;
      line-height: 1.4;
      transform-origin: left center;
  }
  
  :global(.lyric-line:hover) {
      color: rgba(255,255,255,0.7);
  }
  
  :global(.lyric-line.active) {
      color: white;
      font-weight: 700;
      transform: scale(1.05); /* Zoom effect */
      opacity: 1;
      text-shadow: 0 0 20px rgba(255,255,255,0.2);
  }
</style>
